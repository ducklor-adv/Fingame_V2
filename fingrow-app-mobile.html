<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Fingrow - Finpoint Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    input, select, textarea { font-size: 16px !important; }
    html { scroll-behavior: smooth; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Bottom nav safe area for iOS */
    .bottom-nav-safe {
      padding-bottom: env(safe-area-inset-bottom);
    }
  </style>
</head>
<body class="bg-slate-950">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API Configuration
    const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3001' : '';

    // Mock User (fallback for demo)
    const mockUser = {
      id: "4d003630-3ed6-4d80-89fd-5c1d2f017be1",
      worldId: "25AAA0001",
      username: "somchai_jaidee",
      firstName: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
      lastName: "‡πÉ‡∏à‡∏î‡∏µ",
      firstName: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
      lastName: "‡πÉ‡∏à‡∏î‡∏µ",
      email: "somchai@fingrow.com",
      phone: "0812345678",
      avatarUrl: null,
      bio: "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Fingrow",
      isVerified: true,
      verificationLevel: 3,
      trustScore: 95.5,
      totalSales: 152,
      totalPurchases: 89,
      runNumber: 1,
      level: 1,
      childCount: 3,
      maxChildren: 5,
      acfAccepting: true,
      inviterUsername: "system_root",
      inviteCode: "DEMO2025",
      ownFinpoint: 3250,
      totalFinpoint: 12500,
      maxNetwork: 19531,
      addressNumber: "123/45",
      addressStreet: "‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó",
      addressSubDistrict: "‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢",
      addressDistrict: "‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢",
      addressProvince: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£",
      addressPostalCode: "10110",
    };

    const mockDashboardData = {
      currentFpBalance: 3250,
      lastUpdated: "23/11/2025 14:32",
      todayEarned: 120,
      todayFromSecondhand: 80,
      todayFromUpline: 40,
      expProgressList: [
        { code: "LEVEL_1", label: "Level 1 ‚Äì ‡∏û‡∏£‡∏ö.", target: 600, current: 420 },
        { code: "LEVEL_2", label: "Level 2 ‚Äì ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢‡∏£‡∏ñ", target: 5000, current: 1350 },
        { code: "LEVEL_3", label: "Level 3 ‚Äì ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", target: 20000, current: 2500 },
        { code: "LEVEL_4", label: "Level 4 ‚Äì ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", target: 50000, current: 0 },
      ],
      recentLedger: [
        { id: 1, datetime: "23/11 14:10", category: "‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á", detail: "#S-1021", drCr: "DR", amount: 70, balanceAfter: 3250 },
        { id: 2, datetime: "23/11 09:00", category: "‡∏û‡∏£‡∏ö. ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô", detail: "Self 45%", drCr: "DR", amount: 30, balanceAfter: 3180 },
        { id: 3, datetime: "22/11 18:30", category: "Network Bonus", detail: "‡∏à‡∏≤‡∏Å downline", drCr: "DR", amount: 15, balanceAfter: 3150 },
        { id: 4, datetime: "22/11 10:15", category: "‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á", detail: "#S-1015", drCr: "DR", amount: 55, balanceAfter: 3135 },
        { id: 5, datetime: "21/11 16:20", category: "‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", detail: "#E-450", drCr: "CR", amount: 200, balanceAfter: 3080 },
      ],
      networkSnapshot: {
        networkSize: 1235,
        fpFromYou: 120,
        uplinePath: [
          { id: "25AAA0001", name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ", worldId: "25AAA0001" },
          { id: "25AAA0015", name: "‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏î‡∏µ", worldId: "25AAA0015" },
          { id: "25AAA0032", name: "‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á", worldId: "25AAA0032" },
          { id: "25AAA0087", name: "‡∏™‡∏°‡∏û‡∏£ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à", worldId: "25AAA0087" },
          { id: "25AAA0120", name: "‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡πÄ‡∏à‡∏£‡∏¥‡∏ç", worldId: "25AAA0120" },
          { id: "25AAA0230", name: "‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò ‡∏î‡∏µ‡∏á‡∏≤‡∏°", worldId: "25AAA0230" },
          { id: "25AAA0000", name: "SYSTEM ROOT", worldId: "25AAA0000" },
        ],
      },
    };

    // Main App Component
    function App() {
      const [currentPage, setCurrentPage] = useState('home');
      const [userData, setUserData] = useState(null);
      const [dashboardData, setDashboardData] = useState(null);
      const [isLoading, setIsLoading] = useState(true);
      const [isLoggedIn, setIsLoggedIn] = useState(false);

      // Fetch data from API
      const fetchUserData = async () => {
        try {
          setIsLoading(true);
          // Get user ID from localStorage or use mock
          const userId = localStorage.getItem('userId') || mockUser.id;

          // Fetch user data
          const userResponse = await fetch(`${API_BASE}/api/users/${userId}`);
          if (userResponse.ok) {
            const user = await userResponse.json();
            setUserData(user);
          } else {
            // Fallback to mock data
            setUserData(mockUser);
          }

          // Fetch ALL dashboard data including insurance levels
          const finpointResponse = await fetch(`${API_BASE}/api/finpoint/${userId}/balance`);
          const transactionsResponse = await fetch(`${API_BASE}/api/finpoint/${userId}/transactions?limit=20`);
          const todayResponse = await fetch(`${API_BASE}/api/finpoint/${userId}/today`);
          const networkResponse = await fetch(`${API_BASE}/api/network/${userId}/summary`);
          const insuranceResponse = await fetch(`${API_BASE}/api/insurance/${userId}/levels`);

          if (finpointResponse.ok && transactionsResponse.ok && todayResponse.ok && networkResponse.ok && insuranceResponse.ok) {
            const [finpoint, transactions, today, network, insurance] = await Promise.all([
              finpointResponse.json(),
              transactionsResponse.json(),
              todayResponse.json(),
              networkResponse.json(),
              insuranceResponse.json()
            ]);

            setDashboardData({
              currentFpBalance: finpoint.balance || 0,
              lastUpdated: new Date().toLocaleString('th-TH'),
              todayEarned: today.totalEarned || 0,
              todayFromSecondhand: today.fromSecondhand || 0,
              todayFromUpline: today.fromUpline || 0,
              expProgressList: insurance.levels || [],
              recentLedger: transactions.transactions || [],
              networkSnapshot: network.snapshot || {
                networkSize: 0,
                fpFromYou: 0,
                uplinePath: []
              }
            });
          } else {
            console.error('API Error - Some endpoints failed');
            setUserData(mockUser);
            setDashboardData(mockDashboardData);
          }
        } catch (error) {
          console.error('Error fetching data:', error);
          // Fallback to mock data
          setUserData(mockUser);
          setDashboardData(mockDashboardData);
        } finally {
          setIsLoading(false);
        }
      };

      // Fetch data on mount
      useEffect(() => {
        // Check if user is logged in
        const storedUserId = localStorage.getItem('userId');
        const storedWorldId = localStorage.getItem('worldId');

        if (storedUserId || storedWorldId) {
          setIsLoggedIn(true);
          fetchUserData();
        } else {
          setIsLoading(false);
          setIsLoggedIn(false);
        }
      }, []);

      // Show login page if not logged in
      if (!isLoggedIn && !isLoading) {
        return <LoginPage onLogin={(userId, worldId) => {
          localStorage.setItem('userId', userId);
          localStorage.setItem('worldId', worldId);
          setIsLoggedIn(true);
          fetchUserData();
        }} />;
      }

      if (isLoading) {
        return (
          <div className="min-h-screen bg-slate-950 text-slate-100 flex items-center justify-center">
            <div className="text-center">
              <div className="text-4xl mb-4">üíé</div>
              <div className="text-lg font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
              <div className="text-sm text-slate-400 mt-2">Fingrow Dashboard</div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-slate-950 text-slate-100 pb-16">
          {/* Content */}
          {currentPage === 'home' && <HomePage data={dashboardData} user={userData} />}
          {currentPage === 'transactions' && <TransactionsPage data={dashboardData} user={userData} />}
          {currentPage === 'tree' && <TreePage user={userData} />}
          {currentPage === 'acf' && <ACFPage user={userData} />}
          {currentPage === 'database' && <DatabaseViewer />}
          {currentPage === 'profile' && <ProfilePage user={userData} setUser={setUserData} onLogout={() => {
            localStorage.removeItem('userId');
            localStorage.removeItem('worldId');
            setIsLoggedIn(false);
            setUserData(null);
            setDashboardData(null);
          }} />}

          {/* Bottom Navigation */}
          <BottomNav currentPage={currentPage} setCurrentPage={setCurrentPage} />
        </div>
      );
    }

    // Login Page
    function LoginPage({ onLogin }) {
      const [loginMode, setLoginMode] = useState('quick'); // 'quick' or 'credential'
      const [worldId, setWorldId] = useState('');
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState('');

      const handleQuickLogin = async (testWorldId) => {
        setIsLoading(true);
        setError('');
        try {
          const response = await fetch(`${API_BASE}/api/users/world/${testWorldId}`);
          if (response.ok) {
            const user = await response.json();
            onLogin(user.id, user.worldId);
          } else {
            setError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
          }
        } catch (err) {
          setError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
        } finally {
          setIsLoading(false);
        }
      };

      const handleCredentialLogin = async (e) => {
        e.preventDefault();
        if (!username.trim() || !password.trim()) {
          setError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Username ‡πÅ‡∏•‡∏∞ Password');
          return;
        }

        setIsLoading(true);
        setError('');
        try {
          // Simple credential check (in production, this should be server-side)
          if (username === 'system_root' && password === 'system_root') {
            // Login as system root
            const response = await fetch(`${API_BASE}/api/users/world/25AAA0000`);
            if (response.ok) {
              const user = await response.json();
              onLogin(user.id, user.worldId);
            } else {
              setError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ System Root');
            }
          } else {
            // Try to find user by username
            const response = await fetch(`${API_BASE}/api/users/username/${username}`);
            if (response.ok) {
              const user = await response.json();
              // In production, verify password on server
              onLogin(user.id, user.worldId);
            } else {
              setError('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
          }
        } catch (err) {
          setError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
        } finally {
          setIsLoading(false);
        }
      };

      const handleWorldIdLogin = async (e) => {
        e.preventDefault();
        if (!worldId.trim()) {
          setError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà World ID');
          return;
        }
        handleQuickLogin(worldId.trim());
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-100 flex items-center justify-center p-4">
          <div className="w-full max-w-md">
            {/* Logo */}
            <div className="text-center mb-8">
              <div className="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-4xl">
                üíé
              </div>
              <h1 className="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent">
                Fingrow
              </h1>
              <p className="text-slate-400 text-sm mt-2">Financial Network Platform</p>
            </div>

            {/* Login Card */}
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl p-6 backdrop-blur-lg">
              <h2 className="text-xl font-semibold mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

              {/* Login Mode Tabs */}
              <div className="flex gap-2 mb-6">
                <button
                  onClick={() => setLoginMode('quick')}
                  className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors ${
                    loginMode === 'quick'
                      ? 'bg-emerald-600 text-white'
                      : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                  }`}
                >
                  Quick Login
                </button>
                <button
                  onClick={() => setLoginMode('credential')}
                  className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors ${
                    loginMode === 'credential'
                      ? 'bg-emerald-600 text-white'
                      : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                  }`}
                >
                  Username/Password
                </button>
              </div>

              {/* Quick Login Mode */}
              {loginMode === 'quick' && (
                <>
                  {/* Admin/Root Login */}
                  <div className="mb-4">
                    <p className="text-sm text-slate-400 mb-3">üîë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö:</p>
                    <button
                      onClick={() => handleQuickLogin('25AAA0000')}
                      disabled={isLoading}
                      className="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2"
                    >
                      <span>üëë</span>
                      <span>System Root (25AAA0000)</span>
                    </button>
                  </div>

                  {/* Divider */}
                  <div className="relative my-6">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-slate-700"></div>
                    </div>
                    <div className="relative flex justify-center text-xs uppercase">
                      <span className="bg-slate-900 px-2 text-slate-400">Test Users</span>
                    </div>
                  </div>

                  {/* Test Users Quick Login */}
                  <div className="space-y-3 mb-6">
                    <button
                      onClick={() => handleQuickLogin('25AAA0001')}
                      disabled={isLoading}
                      className="w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50"
                    >
                      üßë Somchai Jaidee (25AAA0001)
                    </button>
                    <button
                      onClick={() => handleQuickLogin('25AAA0002')}
                      disabled={isLoading}
                      className="w-full px-4 py-3 bg-teal-600 hover:bg-teal-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50"
                    >
                      üë© Somsri Rakdee (25AAA0002)
                    </button>
                  </div>

                  {/* Divider */}
                  <div className="relative my-6">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-slate-700"></div>
                    </div>
                    <div className="relative flex justify-center text-xs uppercase">
                      <span className="bg-slate-900 px-2 text-slate-400">‡∏´‡∏£‡∏∑‡∏≠ World ID</span>
                    </div>
                  </div>

                  {/* World ID Login Form */}
                  <form onSubmit={handleWorldIdLogin} className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-300 mb-2">
                        World ID
                      </label>
                      <input
                        type="text"
                        value={worldId}
                        onChange={(e) => setWorldId(e.target.value)}
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô 25AAA0001"
                        className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                      />
                    </div>

                    {error && (
                      <div className="px-4 py-3 bg-rose-900/20 border border-rose-500/50 rounded-lg text-rose-300 text-sm">
                        {error}
                      </div>
                    )}

                    <button
                      type="submit"
                      disabled={isLoading}
                      className="w-full px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50"
                    >
                      {isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}
                    </button>
                  </form>
                </>
              )}

              {/* Credential Login Mode */}
              {loginMode === 'credential' && (
                <form onSubmit={handleCredentialLogin} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-300 mb-2">
                      Username
                    </label>
                    <input
                      type="text"
                      value={username}
                      onChange={(e) => setUsername(e.target.value)}
                      placeholder="system_root, somchai_jaidee, ..."
                      className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-300 mb-2">
                      Password
                    </label>
                    <input
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>

                  {error && (
                    <div className="px-4 py-3 bg-rose-900/20 border border-rose-500/50 rounded-lg text-rose-300 text-sm">
                      {error}
                    </div>
                  )}

                  <button
                    type="submit"
                    disabled={isLoading}
                    className="w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50"
                  >
                    {isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}
                  </button>

                  {/* Hint */}
                  <div className="text-xs text-slate-500 text-center">
                    üí° Admin: username = <code className="text-blue-400">system_root</code>, password = <code className="text-blue-400">system_root</code>
                  </div>
                </form>
              )}

              {/* Info */}
              <div className="mt-6 pt-6 border-t border-slate-800">
                <div className="text-xs text-slate-400 space-y-1">
                  <p>üí° <strong>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö:</strong> ‡πÉ‡∏ä‡πâ World ID ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
                  <p>üóÑÔ∏è <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á:</strong> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö PostgreSQL Database</p>
                </div>
              </div>
            </div>

            {/* Footer */}
            <div className="text-center mt-6 text-xs text-slate-500">
              Fingrow v2.0 - Real Database Connection
            </div>
          </div>
        </div>
      );
    }

    // Insurance Selection Modal Component
    function InsuranceSelectionModal({ level, userId, onClose }) {
      const [products, setProducts] = useState([]);
      const [selectedProducts, setSelectedProducts] = useState([]);
      const [loading, setLoading] = useState(true);
      const [saving, setSaving] = useState(false);

      useEffect(() => {
        const fetchData = async () => {
          try {
            setLoading(true);
            // Fetch available products for this level
            const productsRes = await fetch(`${API_BASE}/api/insurance/products?level=${level}`);
            if (productsRes.ok) {
              const productsData = await productsRes.json();
              setProducts(productsData.products || []);
            }

            // Fetch user's current selections
            const selectionsRes = await fetch(`${API_BASE}/api/insurance/selections/${userId}`);
            if (selectionsRes.ok) {
              const selectionsData = await selectionsRes.json();
              const levelSelections = selectionsData.selections
                .filter(s => s.product.fingrowLevel === level)
                .map(s => s.insuranceProductId);
              setSelectedProducts(levelSelections);
            }
          } catch (error) {
            console.error('Error fetching insurance data:', error);
          } finally {
            setLoading(false);
          }
        };

        fetchData();
      }, [level, userId]);

      const toggleProduct = (productId) => {
        if (selectedProducts.includes(productId)) {
          setSelectedProducts(selectedProducts.filter(id => id !== productId));
        } else {
          setSelectedProducts([...selectedProducts, productId]);
        }
      };

      const handleSave = async () => {
        try {
          setSaving(true);

          // Get current selections from server
          const selectionsRes = await fetch(`${API_BASE}/api/insurance/selections/${userId}`);
          const selectionsData = await selectionsRes.json();
          const currentLevelSelections = selectionsData.selections.filter(
            s => s.product.fingrowLevel === level
          );

          // Deactivate products that were unselected
          for (const selection of currentLevelSelections) {
            if (!selectedProducts.includes(selection.insuranceProductId)) {
              await fetch(`${API_BASE}/api/insurance/selections/${selection.id}`, {
                method: 'DELETE'
              });
            }
          }

          // Add new products that were selected
          const currentIds = currentLevelSelections.map(s => s.insuranceProductId);
          for (const productId of selectedProducts) {
            if (!currentIds.includes(productId)) {
              await fetch(`${API_BASE}/api/insurance/selections`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, insuranceProductId: productId })
              });
            }
          }

          onClose();
        } catch (error) {
          console.error('Error saving selections:', error);
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        } finally {
          setSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
          <div className="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-lg max-h-[90vh] flex flex-col shadow-2xl">
            {/* Header */}
            <div className="flex items-center justify-between p-5 border-b border-slate-800">
              <h2 className="text-lg font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô Level {level}</h2>
              <button
                onClick={onClose}
                className="w-8 h-8 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 hover:text-white transition-colors"
              >
                ‚úï
              </button>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-y-auto p-5">
              {loading ? (
                <div className="text-center py-12 text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
              ) : products.length === 0 ? (
                <div className="text-center py-12 text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Level ‡∏ô‡∏µ‡πâ</div>
              ) : (
                <div className="space-y-3">
                  {products.map((product) => (
                    <div
                      key={product.id}
                      onClick={() => toggleProduct(product.id)}
                      className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${
                        selectedProducts.includes(product.id)
                          ? 'border-emerald-500 bg-emerald-500/10'
                          : 'border-slate-700 bg-slate-800/40 hover:border-slate-600'
                      }`}
                    >
                      <div className="flex items-start gap-3">
                        <div className={`w-5 h-5 mt-0.5 rounded border-2 flex items-center justify-center flex-shrink-0 ${
                          selectedProducts.includes(product.id)
                            ? 'border-emerald-500 bg-emerald-500'
                            : 'border-slate-600'
                        }`}>
                          {selectedProducts.includes(product.id) && (
                            <span className="text-white text-xs">‚úì</span>
                          )}
                        </div>
                        <div className="flex-1 min-w-0">
                          <h3 className="font-medium text-sm mb-1">{product.shortTitle || product.title}</h3>
                          <div className="text-xs text-slate-400 mb-2">{product.insurerCompanyName}</div>
                          <div className="flex items-center gap-3 text-xs">
                            <span className="text-emerald-300 font-medium">
                              {product.premiumTotal?.toLocaleString()} THB
                            </span>
                            <span className="text-slate-500">‚Ä¢</span>
                            <span className="text-cyan-300">
                              {product.finpointRatePer100} FP/100‡∏ø
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="p-5 border-t border-slate-800 flex gap-3">
              <button
                onClick={onClose}
                className="flex-1 px-4 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 font-medium transition-colors"
              >
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
              </button>
              <button
                onClick={handleSave}
                disabled={saving}
                className="flex-1 px-4 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {saving ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Home Page (Dashboard)
    function HomePage({ data, user }) {
      const [showInsuranceModal, setShowInsuranceModal] = useState(false);
      const [selectedLevel, setSelectedLevel] = useState(null);
      const [insuranceSelections, setInsuranceSelections] = useState({});
      const [loadingSelections, setLoadingSelections] = useState(true);

      // Fetch user's insurance selections
      useEffect(() => {
        const fetchSelections = async () => {
          try {
            setLoadingSelections(true);
            const response = await fetch(`${API_BASE}/api/insurance/selections/${user.id}`);
            if (response.ok) {
              const data = await response.json();
              // Group selections by level
              const selectionsByLevel = {};
              data.selections.forEach(selection => {
                const level = selection.product.fingrowLevel;
                if (!selectionsByLevel[level]) {
                  selectionsByLevel[level] = [];
                }
                selectionsByLevel[level].push(selection.product);
              });
              setInsuranceSelections(selectionsByLevel);
            }
          } catch (error) {
            console.error('Error fetching insurance selections:', error);
          } finally {
            setLoadingSelections(false);
          }
        };

        if (user && user.id) {
          fetchSelections();
        }
      }, [user]);

      const handleSettingsClick = (exp) => {
        // Extract level number from code (e.g., "LEVEL_1" -> 1)
        const levelMatch = exp.code.match(/LEVEL_(\d+)/);
        if (levelMatch) {
          setSelectedLevel(parseInt(levelMatch[1]));
          setShowInsuranceModal(true);
        }
      };

      const handleModalClose = () => {
        setShowInsuranceModal(false);
        setSelectedLevel(null);
        // Refresh selections after modal closes
        const fetchSelections = async () => {
          try {
            const response = await fetch(`${API_BASE}/api/insurance/selections/${user.id}`);
            if (response.ok) {
              const data = await response.json();
              const selectionsByLevel = {};
              data.selections.forEach(selection => {
                const level = selection.product.fingrowLevel;
                if (!selectionsByLevel[level]) {
                  selectionsByLevel[level] = [];
                }
                selectionsByLevel[level].push(selection.product);
              });
              setInsuranceSelections(selectionsByLevel);
            }
          } catch (error) {
            console.error('Error fetching insurance selections:', error);
          }
        };
        fetchSelections();
      };

      return (
        <div className="pb-4">
          {/* Insurance Selection Modal */}
          {showInsuranceModal && (
            <InsuranceSelectionModal
              level={selectedLevel}
              userId={user.id}
              onClose={handleModalClose}
            />
          )}

          {/* Header */}
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800">
            <div className="px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-emerald-400/20 border border-emerald-400/50 flex items-center justify-center text-xs font-bold text-emerald-300">
                  FG
                </div>
                <div>
                  <h1 className="text-sm font-semibold">Fingrow</h1>
                  <p className="text-xs text-slate-400">Dashboard</p>
                </div>
              </div>
              <div className="flex items-center gap-2 text-xs">
                <span className="hidden sm:inline text-slate-400">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ,</span>
                <span className="font-medium">{user.firstName}</span>
                <div className="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center">
                  üë§
                </div>
              </div>
            </div>
          </header>

          {/* FP Balance Card */}
          <section className="p-4">
            <div className="bg-gradient-to-br from-emerald-900/60 to-teal-900/60 border border-emerald-700/50 rounded-2xl p-5 shadow-lg">
              <div className="flex items-center justify-between mb-3">
                <div>
                  <h2 className="text-xs uppercase tracking-wide text-emerald-300/80">‡∏¢‡∏≠‡∏î Finpoint</h2>
                  <p className="mt-1 text-3xl sm:text-4xl font-bold text-emerald-300">
                    {data.currentFpBalance.toLocaleString()} <span className="text-lg">FP</span>
                  </p>
                </div>
                <div className="w-12 h-12 bg-emerald-400/20 rounded-full flex items-center justify-center text-2xl">
                  üíé
                </div>
              </div>
              <div className="text-xs text-emerald-300/60">
                ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {data.lastUpdated}
              </div>
            </div>
          </section>

          {/* Today Stats - Horizontal Scroll */}
          <section className="px-4 pb-4">
            <div className="overflow-x-auto hide-scrollbar">
              <div className="flex gap-3 pb-2">
                <StatCard label="FP ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" value={`+${data.todayEarned}`} color="emerald" />
                <StatCard label="‡∏à‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á" value={`+${data.todayFromSecondhand}`} color="teal" />
                <StatCard label="‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢" value={`+${data.todayFromUpline}`} color="cyan" />
              </div>
            </div>
          </section>

          {/* Network Snapshot */}
          <section className="px-4 pb-4">
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
              <h3 className="text-sm font-semibold mb-3 flex items-center gap-2">
                <span>üåê</span> ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ ACF
              </h3>
              <div className="grid grid-cols-2 gap-3 text-sm">
                <div>
                  <div className="text-xs text-slate-400 mb-1">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
                  <div className="text-lg font-bold text-emerald-300">{data.networkSnapshot.networkSize.toLocaleString()}</div>
                </div>
                <div>
                  <div className="text-xs text-slate-400 mb-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö FP ‡πÅ‡∏•‡πâ‡∏ß</div>
                  <div className="text-lg font-bold text-cyan-300">{data.networkSnapshot.fpFromYou.toLocaleString()}</div>
                </div>
              </div>
            </div>
          </section>

          {/* Level Progress */}
          <section className="px-4 pb-4">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-sm font-semibold">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Level</h3>
              <span className="text-xs text-slate-400">‡πÉ‡∏ä‡πâ FP ‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</span>
            </div>
            <div className="space-y-3">
              {data.expProgressList.map((exp) => {
                const levelMatch = exp.code.match(/LEVEL_(\d+)/);
                const levelNum = levelMatch ? parseInt(levelMatch[1]) : null;
                const selectedProducts = levelNum && insuranceSelections[levelNum] ? insuranceSelections[levelNum] : [];

                return (
                  <ExpCard
                    key={exp.code}
                    exp={exp}
                    selectedProducts={selectedProducts}
                    onSettingsClick={handleSettingsClick}
                  />
                );
              })}
            </div>
          </section>
        </div>
      );
    }

    // Transactions Page (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
    function TransactionsPage({ data, user }) {
      const [filter, setFilter] = useState('all'); // all, dr, cr
      const [uplineList, setUplineList] = useState([]);
      const [loadingUpline, setLoadingUpline] = useState(true);

      // Fetch upline list
      useEffect(() => {
        const fetchUplineList = async () => {
          try {
            setLoadingUpline(true);
            const response = await fetch(`${API_BASE}/api/users/${user.id}/upline-list`);
            if (response.ok) {
              const data = await response.json();
              setUplineList(data.uplines || []);
            }
          } catch (error) {
            console.error('Error fetching upline list:', error);
          } finally {
            setLoadingUpline(false);
          }
        };

        if (user && user.id) {
          fetchUplineList();
        }
      }, [user]);

      const filteredLedger = data.recentLedger.filter(row => {
        if (filter === 'all') return true;
        return row.drCr.toLowerCase() === filter;
      });

      return (
        <div className="pb-4">
          {/* Header */}
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800">
            <div className="px-4 py-3">
              <h1 className="text-base font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h1>
              <p className="text-xs text-slate-400 mt-1">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Finpoint</p>
            </div>
          </header>

          {/* Commission Pool List */}
          <section className="p-4">
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-sm font-semibold text-slate-200">Commission Pool List</h3>
                <span className="text-xs text-slate-400">{uplineList.length} ‡∏Ñ‡∏ô</span>
              </div>
              {loadingUpline ? (
                <div className="text-center py-4 text-slate-400 text-sm">
                  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
                </div>
              ) : uplineList.length === 0 ? (
                <div className="text-center py-4 text-slate-400 text-sm">
                  ‡πÑ‡∏°‡πà‡∏°‡∏µ upline
                </div>
              ) : (
                <div className="space-y-2">
                  {uplineList.map((upline, idx) => (
                    <div key={upline.id} className="flex items-center gap-3 p-3 bg-slate-800/40 rounded-lg">
                      <div className="w-8 h-8 rounded-full bg-emerald-600/20 text-emerald-300 flex items-center justify-center text-xs font-bold">
                        {idx + 1}
                      </div>
                      <div className="flex-1 min-w-0">
                        <div className="text-sm font-medium text-slate-200 truncate">{upline.username}</div>
                        <div className="text-xs text-slate-400">{upline.worldId}</div>
                      </div>
                      <div className="text-xs text-slate-500">
                        Level {upline.level}
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </section>

          {/* Summary Card */}
          <section className="px-4 pb-4">
            <div className="bg-gradient-to-br from-slate-900/60 to-slate-800/60 border border-slate-700/50 rounded-2xl p-4">
              <div className="grid grid-cols-3 gap-3 text-center">
                <div>
                  <div className="text-xs text-slate-400 mb-1">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                  <div className="text-lg font-bold text-emerald-300">{data.currentFpBalance.toLocaleString()}</div>
                  <div className="text-xs text-slate-500">FP</div>
                </div>
                <div>
                  <div className="text-xs text-slate-400 mb-1">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</div>
                  <div className="text-lg font-bold text-emerald-300">
                    {data.recentLedger.filter(r => r.drCr === 'DR').reduce((sum, r) => sum + r.amount, 0).toLocaleString()}
                  </div>
                  <div className="text-xs text-slate-500">FP</div>
                </div>
                <div>
                  <div className="text-xs text-slate-400 mb-1">‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</div>
                  <div className="text-lg font-bold text-rose-300">
                    {data.recentLedger.filter(r => r.drCr === 'CR').reduce((sum, r) => sum + r.amount, 0).toLocaleString()}
                  </div>
                  <div className="text-xs text-slate-500">FP</div>
                </div>
              </div>
            </div>
          </section>

          {/* Filter Tabs */}
          <section className="px-4 pb-3">
            <div className="flex gap-2">
              <button onClick={() => setFilter('all')}
                className={`flex-1 py-2 rounded-lg text-sm font-medium transition ${
                  filter === 'all' ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-300'
                }`}>
                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({data.recentLedger.length})
              </button>
              <button onClick={() => setFilter('dr')}
                className={`flex-1 py-2 rounded-lg text-sm font-medium transition ${
                  filter === 'dr' ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-300'
                }`}>
                ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ({data.recentLedger.filter(r => r.drCr === 'DR').length})
              </button>
              <button onClick={() => setFilter('cr')}
                className={`flex-1 py-2 rounded-lg text-sm font-medium transition ${
                  filter === 'cr' ? 'bg-rose-600 text-white' : 'bg-slate-800 text-slate-300'
                }`}>
                ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å ({data.recentLedger.filter(r => r.drCr === 'CR').length})
              </button>
            </div>
          </section>

          {/* Transaction List */}
          <section className="px-4 pb-4">
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl overflow-hidden">
              {filteredLedger.length === 0 ? (
                <div className="px-4 py-8 text-center text-slate-400">
                  <div className="text-3xl mb-2">üìã</div>
                  <div className="text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
              ) : (
                filteredLedger.map((row, idx) => (
                  <div key={row.id} className={`px-4 py-3 ${idx > 0 ? 'border-t border-slate-800' : ''}`}>
                    <div className="flex items-start justify-between gap-3">
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-1">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm ${
                            row.drCr === 'DR' ? 'bg-emerald-500/20 text-emerald-300' : 'bg-rose-500/20 text-rose-300'
                          }`}>
                            {row.drCr === 'DR' ? '‚Üì' : '‚Üë'}
                          </div>
                          <div className="flex-1 min-w-0">
                            <div className="text-sm font-medium text-slate-200 truncate">{row.category}</div>
                            <div className="text-xs text-slate-400">{row.detail}</div>
                          </div>
                        </div>
                        <div className="text-xs text-slate-500 ml-10">{row.datetime}</div>
                      </div>
                      <div className="text-right">
                        <div className={`text-base font-semibold ${row.drCr === 'DR' ? 'text-emerald-300' : 'text-rose-300'}`}>
                          {row.drCr === 'DR' ? '+' : '-'}{row.amount.toLocaleString()}
                        </div>
                        <div className="text-xs text-slate-500">
                          ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span className="font-mono">{row.balanceAfter.toLocaleString()}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>
          </section>

          {/* Info Footer */}
          <section className="px-4 pb-4">
            <div className="bg-slate-900/40 border border-slate-800 rounded-xl p-3">
              <div className="flex items-start gap-2">
                <div className="text-slate-400 mt-0.5">‚ÑπÔ∏è</div>
                <div className="flex-1">
                  <div className="text-xs text-slate-400 leading-relaxed">
                    <div className="mb-1"><span className="text-emerald-300">‚Ä¢ ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (DR)</span> = ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Finpoint ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢, ‡πÇ‡∏ö‡∏ô‡∏±‡∏™, ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <div><span className="text-rose-300">‚Ä¢ ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å (CR)</span> = ‡πÉ‡∏ä‡πâ Finpoint ‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      );
    }

    // Tree Page
    function TreePage({ user }) {
      const [viewingUser, setViewingUser] = useState({ id: user.id, worldId: user.worldId, username: user.username, parentId: null });
      const [networkData, setNetworkData] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [parentInfo, setParentInfo] = useState(null);

      // Fetch network tree from API
      useEffect(() => {
        const fetchNetworkTree = async () => {
          try {
            setIsLoading(true);
            const response = await fetch(`${API_BASE}/api/network/${viewingUser.id}/tree`);
            if (response.ok) {
              const data = await response.json();

              // Store parent info if exists
              if (data.root && data.root.parentId) {
                setParentInfo({
                  id: data.root.parentId,
                  worldId: null, // Will fetch from user API
                  username: null
                });

                // Fetch parent user info
                fetch(`${API_BASE}/api/users/${data.root.parentId}`)
                  .then(res => res.json())
                  .then(parentData => {
                    setParentInfo({
                      id: parentData.id,
                      worldId: parentData.worldId,
                      username: parentData.username
                    });
                  })
                  .catch(err => console.error('Failed to fetch parent info:', err));
              } else {
                setParentInfo(null);
              }

              // Transform API data to match component format
              if (data.children && data.children.length > 0) {
                setNetworkData([{
                  userId: viewingUser.worldId,
                  username: viewingUser.username,
                  parentId: data.root?.parentId || null,
                  childCount: data.childCount || 0,
                  avatarUrl: null,
                  children: data.children.map(child => ({
                    userId: child.userId,
                    username: child.username,
                    childCount: child.childCount || 0,
                    avatarUrl: null,
                    children: child.children || [],
                    userDbId: child.userDbId // Keep DB ID for navigation
                  }))
                }]);
              } else {
                // No children, show empty
                setNetworkData([{
                  userId: viewingUser.worldId,
                  username: viewingUser.username,
                  parentId: data.root?.parentId || null,
                  childCount: 0,
                  avatarUrl: null,
                  children: []
                }]);
              }
            } else {
              console.error('Failed to fetch network tree');
              setNetworkData([]);
            }
          } catch (error) {
            console.error('Error fetching network tree:', error);
            setNetworkData([]);
          } finally {
            setIsLoading(false);
          }
        };

        if (viewingUser && viewingUser.id) {
          fetchNetworkTree();
        }
      }, [viewingUser]);

      return (
        <div className="pb-4">
          {/* Header */}
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800">
            <div className="px-4 py-3">
              <h1 className="text-base font-semibold">Network Tree</h1>
              <p className="text-xs text-slate-400 mt-1">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å DB)</p>
            </div>
          </header>

          {/* Tree Header */}
          <section className="p-4 border-b border-slate-800 bg-slate-900/40">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center ring-2 ring-emerald-500">
                  üë§
                </div>
                <div>
                  <div className="text-xs text-slate-400">View from:</div>
                  <div className="text-sm font-semibold">{viewingUser.worldId} ¬∑ {viewingUser.username}</div>
                </div>
              </div>
              <div className="flex gap-2">
                {parentInfo && (
                  <button
                    onClick={() => setViewingUser({ id: parentInfo.id, worldId: parentInfo.worldId, username: parentInfo.username })}
                    className="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg text-xs flex items-center gap-1"
                    title={`‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π ${parentInfo.username}`}
                  >
                    <span>‚Üê</span>
                    <span>Back</span>
                  </button>
                )}
                {viewingUser.worldId !== user.worldId && (
                  <button
                    onClick={() => setViewingUser({ id: user.id, worldId: user.worldId, username: user.username })}
                    className="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs"
                  >
                    Reset
                  </button>
                )}
              </div>
            </div>
            <p className="text-xs text-slate-400">
              ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á user ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤
            </p>
          </section>

          {/* Tree Content */}
          <section className="p-4">
            {isLoading ? (
              <div className="text-center py-8">
                <div className="text-2xl mb-2">‚è≥</div>
                <div className="text-sm text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢...</div>
              </div>
            ) : networkData.length === 0 || !networkData[0].children || networkData[0].children.length === 0 ? (
              <div className="text-center py-8">
                <div className="text-2xl mb-2">üì≠</div>
                <div className="text-sm text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
              </div>
            ) : (
              <div className="space-y-6">
                {/* Loop through root's children (Level 1) */}
                {networkData[0].children.map((child, childIndex) => (
                  <div key={child.userId} className="network-row border-b border-slate-800 pb-3 last:border-0">
                    {/* Parent + Children in same row */}
                    <div className="grid grid-cols-6 gap-1">
                      {/* Parent Card - 1 column */}
                      <article
                        className="parent-card bg-gradient-to-br from-emerald-600 to-emerald-700 border-2 border-emerald-400 rounded-lg p-1.5 hover:from-emerald-500 hover:to-emerald-600 transition-all cursor-pointer min-h-[60px] flex flex-col items-center justify-center shadow-lg shadow-emerald-900/50"
                        onClick={() => {
                          if (child.userDbId) {
                            setViewingUser({ id: child.userDbId, worldId: child.userId, username: child.username });
                          }
                        }}
                      >
                        <div className="relative mb-0.5">
                          <div className="w-7 h-7 rounded-full bg-white/20 flex items-center justify-center text-[11px] ring-2 ring-white/40">
                            üë§
                          </div>
                          {child.childCount > 0 && (
                            <div className="absolute -bottom-0.5 -right-0.5 bg-yellow-400 text-slate-900 text-[7px] font-bold rounded-full w-3.5 h-3.5 flex items-center justify-center ring-1 ring-emerald-700">
                              {child.childCount}
                            </div>
                          )}
                        </div>
                        <div className="text-[8.5px] text-center truncate w-full text-white leading-tight font-bold">
                          {child.username}
                        </div>
                        <div className="text-[7px] text-emerald-200 font-semibold">
                          ‚óà{child.childCount || 0}
                        </div>
                      </article>

                      {/* Children Grid - 5 columns */}
                          {(child.children || []).map((grandchild) => (
                            <div
                              key={grandchild.userId}
                              className="grandchild-card bg-slate-800/20 rounded p-1 hover:bg-slate-700/40 transition-all cursor-pointer min-h-[60px] flex flex-col items-center justify-center"
                              onClick={() => {
                                if (grandchild.userDbId) {
                                  setViewingUser({ id: grandchild.userDbId, worldId: grandchild.userId, username: grandchild.username });
                                }
                              }}
                            >
                              <div className="relative mb-0.5">
                                <div className="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">
                                  üë§
                                </div>
                                {grandchild.childCount > 0 && (
                                  <div className="absolute -bottom-0.5 -right-0.5 bg-emerald-500 text-white text-[6px] font-bold rounded-full w-3 h-3 flex items-center justify-center">
                                    {grandchild.childCount}
                                  </div>
                                )}
                              </div>
                              <div className="text-[8px] text-center truncate w-full text-slate-300 leading-tight">
                                {grandchild.username}
                              </div>
                              <div className="text-[7px] text-cyan-400">
                                ‚óà{grandchild.childCount || 0}
                              </div>
                            </div>
                          ))}

                      {/* Empty Slots */}
                      {Array.from({ length: Math.max(0, 5 - (child.children || []).length) }).map((_, i) => (
                        <div
                          key={`empty-${childIndex}-${i}`}
                          className="grandchild-card empty border border-dashed border-slate-700/30 rounded p-1 bg-transparent min-h-[60px] flex flex-col items-center justify-center cursor-default"
                        >
                          <div className="w-6 h-6 rounded-full border border-dashed border-slate-600/30"></div>
                          <div className="text-[7px] text-slate-600 mt-0.5">{(child.children || []).length + i + 1}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </section>

          {/* Info Footer */}
          <section className="px-4 pb-4">
            <div className="bg-slate-900/40 border border-slate-800 rounded-xl p-3">
              <div className="flex items-start gap-2">
                <div className="text-slate-400 mt-0.5">‚ÑπÔ∏è</div>
                <div className="flex-1">
                  <div className="text-xs text-slate-400 leading-relaxed">
                    <div className="mb-1">‚Ä¢ ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö hierarchical (parent ‚Üí children)</div>
                    <div>‚Ä¢ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏•‡∏π‡∏Å‡∏ï‡πà‡∏≠ 1 parent ‚Ä¢ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      );
    }

    // Shop Page
    function ShopPage() {
      return (
        <div className="min-h-screen flex items-center justify-center px-4">
          <div className="text-center">
            <div className="text-5xl mb-4">üõí</div>
            <h2 className="text-xl font-bold mb-2">‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á</h2>
            <p className="text-slate-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤...</p>
          </div>
        </div>
      );
    }

    // ACF Page
    function ACFPage({ user }) {
      const [userNetwork, setUserNetwork] = useState([]);
      const [isLoading, setIsLoading] = useState(true);

      // Fetch ACF network from API
      useEffect(() => {
        const fetchACFNetwork = async () => {
          try {
            setIsLoading(true);
            const response = await fetch(`${API_BASE}/api/network/${user.id}/acf`);
            if (response.ok) {
              const data = await response.json();
              // Transform API data to match component format
              if (data.nodes && data.nodes.length > 0) {
                // Sort by level (ascending), then by createdAt (ascending)
                const sortedNodes = data.nodes.sort((a, b) => {
                  if (a.level !== b.level) {
                    return a.level - b.level; // Level ‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô
                  }
                  return new Date(a.createdAt) - new Date(b.createdAt); // ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô
                });

                setUserNetwork(sortedNodes.map(node => ({
                  id: node.id,
                  userId: node.userId,
                  username: node.username,
                  inviterUsername: node.inviterUsername,
                  parentId: node.parentId,
                  parentUsername: node.parentUsername,
                  level: node.level,
                  networkSize: node.networkSize || 0,
                  maxChildren: node.maxChildren || 5,
                  childCount: node.childCount || 0,
                  acfAccepting: node.acfAccepting || false,
                  childrenLevel1: node.childrenLevel1 || [],
                  children: node.children || [],
                  createdAt: node.createdAt
                })));
              } else {
                // Set current user as root if no network data
                setUserNetwork([{
                  id: user.id,
                  userId: user.worldId,
                  username: user.username,
                  parentId: null,
                  level: user.level || 0,
                  networkSize: 1,
                  maxChildren: user.maxChildren || 5,
                  childCount: user.childCount || 0,
                  acfAccepting: user.acfAccepting || false,
                  children: []
                }]);
              }
            } else {
              console.error('Failed to fetch ACF network');
              setUserNetwork([]);
            }
          } catch (error) {
            console.error('Error fetching ACF network:', error);
            setUserNetwork([]);
          } finally {
            setIsLoading(false);
          }
        };

        if (user && user.id) {
          fetchACFNetwork();
        }
      }, [user]);

      return (
        <div className="pb-4">
          {/* Header */}
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800">
            <div className="px-4 py-3">
              <h1 className="text-base font-semibold">ACF Network</h1>
              <p className="text-xs text-slate-400 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ Auto Connection Fill (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á)</p>
            </div>
          </header>

          {/* Root Info */}
          <section className="p-4 border-b border-slate-800 bg-slate-900/40">
            <div className="flex items-center justify-between">
              <div>
                <label className="block text-sm font-medium mb-1">Root ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π</label>
                <div className="text-base font-semibold text-emerald-400">
                  {user.worldId} - {user.username}
                </div>
              </div>
              <div className="text-right">
                <div className="text-xs text-slate-400">Level</div>
                <div className="text-lg font-bold">{user.level || 0}</div>
              </div>
            </div>
            <p className="text-xs text-slate-400 mt-2">
              * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            </p>
          </section>

          {/* Network Table */}
          <section className="p-4">
            {isLoading ? (
              <div className="text-center py-8">
                <div className="text-2xl mb-2">‚è≥</div>
                <div className="text-sm text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ACF...</div>
              </div>
            ) : userNetwork.length === 0 ? (
              <div className="text-center py-8">
                <div className="text-2xl mb-2">üì≠</div>
                <div className="text-sm text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</div>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full text-sm border-collapse">
                <thead className="sticky top-0 bg-slate-800">
                  <tr className="border-b border-slate-700">
                    <th className="px-3 py-3 text-left font-medium text-slate-300">#</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">User</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Invitor</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Parent</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Level</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Network</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Max</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">Count</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300">ACF</th>
                    <th className="px-3 py-3 text-left font-medium text-slate-300" colSpan="5">Childs Level 1</th>
                  </tr>
                </thead>
                <tbody>
                  {userNetwork.map((node, index) => (
                    <tr key={node.id} className="border-b border-slate-800 hover:bg-slate-800/40">
                      <td className="px-3 py-3 font-mono text-slate-400">{index + 1}</td>
                      <td className="px-3 py-3">
                        <button className="underline underline-offset-2 hover:text-emerald-400">
                          {node.username}
                        </button>
                      </td>
                      <td className="px-3 py-3 text-slate-400">{node.inviterUsername || '‚Äî'}</td>
                      <td className="px-3 py-3 text-slate-400">{node.parentUsername || '‚Äî'}</td>
                      <td className="px-3 py-3">{node.level}</td>
                      <td className="px-3 py-3 font-mono">{node.networkSize}/19531</td>
                      <td className="px-3 py-3 text-slate-400">5</td>
                      <td className="px-3 py-3">
                        <span className="px-2 py-1 bg-slate-700 text-slate-300 rounded-full text-xs">
                          {node.childCount}/5
                        </span>
                      </td>
                      <td className="px-3 py-3">
                        <button className={`px-3 py-1 rounded-lg border text-xs font-medium ${
                          node.acfAccepting
                            ? 'border-emerald-500 text-emerald-400'
                            : 'border-rose-500 text-rose-400'
                        }`}>
                          {node.acfAccepting ? 'ON' : 'OFF'}
                        </button>
                      </td>
                      {node.childrenLevel1 && node.childrenLevel1.length > 0 ? (
                        node.childrenLevel1.map((child, i) => (
                          <td key={i} className="px-3 py-3 text-sm">
                            <button className="text-teal-400 hover:text-teal-300 underline underline-offset-2">
                              {child.username}
                            </button>
                          </td>
                        ))
                      ) : null}
                      {Array(5 - (node.childrenLevel1?.length || 0)).fill(null).map((_, i) => (
                        <td key={`empty-${i}`} className="px-3 py-3 text-slate-500">‚Äî</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
              </div>
            )}
          </section>

          {/* Info Footer */}
          <section className="px-4 pb-4">
            <div className="bg-slate-900/40 border border-slate-800 rounded-xl p-3">
              <div className="flex items-start gap-2">
                <div className="text-slate-400 mt-0.5">‚ÑπÔ∏è</div>
                <div className="flex-1">
                  <div className="text-xs text-slate-400 leading-relaxed">
                    <div className="mb-1">‚Ä¢ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
                    <div>‚Ä¢ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ ACF ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      );
    }

    // Profile Page (Simplified)
    function ProfilePage({ user, setUser, onLogout }) {
      const [editing, setEditing] = useState(false);
      const [form, setForm] = useState(user);

      const handleSave = () => {
        setUser(form);
        setEditing(false);
        alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
      };

      const handleLogout = () => {
        if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
          onLogout();
        }
      };

      return (
        <div className="pb-4">
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800 px-4 py-3 flex items-center justify-between">
            <h1 className="text-base font-semibold">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h1>
            <div className="flex gap-2">
              {!editing ? (
                <>
                  <button onClick={() => setEditing(true)} className="px-3 py-1.5 bg-emerald-600 rounded-lg text-xs">
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                  </button>
                  <button onClick={handleLogout} className="px-3 py-1.5 bg-rose-600 hover:bg-rose-700 rounded-lg text-xs">
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                  </button>
                </>
              ) : (
                <>
                  <button onClick={() => { setEditing(false); setForm(user); }} className="px-3 py-1.5 bg-slate-700 rounded-lg text-xs">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                  </button>
                  <button onClick={handleSave} className="px-3 py-1.5 bg-emerald-600 rounded-lg text-xs">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                  </button>
                </>
              )}
            </div>
          </header>

          {/* Profile Header */}
          <section className="bg-slate-900/60 border-b border-slate-800">
            <div className="h-24 bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600"></div>
            <div className="px-4 pb-4 -mt-12">
              <div className="flex flex-col items-center text-center">
                <div className="relative">
                  <div className="w-24 h-24 rounded-full border-4 border-slate-900 bg-slate-800 flex items-center justify-center text-3xl">
                    üë§
                  </div>
                  {user.isVerified && (
                    <div className="absolute bottom-0 right-0 w-8 h-8 bg-emerald-500 rounded-full border-4 border-slate-900 flex items-center justify-center text-sm">
                      ‚úì
                    </div>
                  )}
                </div>
                <h2 className="text-xl font-bold mt-3">{user.username}</h2>
                <p className="text-sm text-slate-400">{user.worldId}</p>
                <div className="flex flex-col gap-2 mt-2 items-center">
                    {/* Level & Run removed from profile header per UI request */}
                  {user.inviterUsername && (
                    <span className="text-xs text-slate-400">
                      ‡∏ú‡∏π‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: <span className="text-emerald-400">@{user.inviterUsername}</span>
                    </span>
                  )}
                </div>
              </div>

              {/* Invite Code & Link Section */}
              <div className="px-4 pb-4 space-y-3">
                {/* Invite Code */}
                <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-3">
                  <div className="text-xs text-slate-400 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üéÅ</div>
                  <div className="flex items-center gap-2">
                    <div className="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2">
                      <div className="font-mono text-sm text-emerald-300 font-bold">
                        {user.inviteCode || user.worldId}
                      </div>
                    </div>
                    <button
                      onClick={() => {
                        navigator.clipboard.writeText(user.inviteCode || user.worldId);
                        alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏¥‡∏ç‡πÅ‡∏•‡πâ‡∏ß!');
                      }}
                      className="px-2 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-[10px] font-medium transition-colors whitespace-nowrap"
                    >
                      ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                    </button>
                  </div>
                </div>

                {/* Invite Link */}
                <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-3">
                  <div className="text-xs text-slate-400 mb-2">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üîó</div>
                  <div className="flex items-center gap-2">
                    <div className="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2">
                      <div className="text-xs text-cyan-300 truncate">
                        {window.location.origin}/register?ref={user.inviteCode || user.worldId}
                      </div>
                    </div>
                    <button
                      onClick={() => {
                        const inviteLink = `${window.location.origin}/register?ref=${user.inviteCode || user.worldId}`;
                        navigator.clipboard.writeText(inviteLink);
                        alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ä‡∏¥‡∏ç‡πÅ‡∏•‡πâ‡∏ß!');
                      }}
                      className="px-2 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-[10px] font-medium transition-colors whitespace-nowrap"
                    >
                      ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                    </button>
                  </div>
                </div>

                {/* Share Button */}
                <button
                  onClick={() => {
                    const inviteLink = `${window.location.origin}/register?ref=${user.inviteCode || user.worldId}`;
                    const shareText = `üéâ ‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á Fingrow ‡∏Å‡∏±‡∏ö‡∏ú‡∏°!\n\n‚ú® ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ\nüí∞ ‡∏£‡∏±‡∏ö Finpoint ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢\nüéÅ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢\n\nüëâ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà: ${inviteLink}`;

                    if (navigator.share) {
                      navigator.share({
                        title: '‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Fingrow',
                        text: shareText,
                        url: inviteLink
                      }).catch(() => {});
                    } else {
                      navigator.clipboard.writeText(shareText);
                      alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏¥‡∏ç‡πÅ‡∏•‡πâ‡∏ß!');
                    }
                  }}
                  className="w-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-medium py-3 rounded-xl transition-all flex items-center justify-center gap-2"
                >
                  <span>üì§</span>
                  <span>‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</span>
                </button>
              </div>
            </div>
          </section>

          {/* Info Form */}
          <section className="px-4 pb-4 space-y-3">
            {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß */}
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 space-y-3">
              <h3 className="text-sm font-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
              <InputField label="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á" value={form.firstName || ''}
                onChange={(v) => setForm({...form, firstName: v})} editing={editing} />
              <InputField label="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" value={form.lastName || ''}
                onChange={(v) => setForm({...form, lastName: v})} editing={editing} />
              <InputField label="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" value={form.email || ''}
                onChange={(v) => setForm({...form, email: v})} editing={editing} type="email" />
              <InputField label="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" value={form.phone || ''}
                onChange={(v) => setForm({...form, phone: v})} editing={editing} type="tel" />
            </div>

            {/* ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà */}
            <div className="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 space-y-3">
              <h3 className="text-sm font-semibold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h3>

              {/* ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡∏ñ‡∏ô‡∏ô */}
              <div className="grid grid-cols-2 gap-3">
                <InputField label="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" value={form.addressNumber || ''}
                  onChange={(v) => setForm({...form, addressNumber: v})} editing={editing}
                  placeholder="123/45" />
                <InputField label="‡∏ñ‡∏ô‡∏ô" value={form.addressStreet || ''}
                  onChange={(v) => setForm({...form, addressStreet: v})} editing={editing}
                  placeholder="‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó" />
              </div>

              {/* ‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏• ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ */}
              <div className="grid grid-cols-2 gap-3">
                <InputField label="‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•" value={form.addressSubDistrict || ''}
                  onChange={(v) => setForm({...form, addressSubDistrict: v})} editing={editing}
                  placeholder="‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢" />
                <InputField label="‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" value={form.addressDistrict || ''}
                  onChange={(v) => setForm({...form, addressDistrict: v})} editing={editing}
                  placeholder="‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢" />
              </div>

              {/* ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå */}
              <div className="grid grid-cols-2 gap-3">
                <InputField label="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" value={form.addressProvince || ''}
                  onChange={(v) => setForm({...form, addressProvince: v})} editing={editing}
                  placeholder="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£" />
                <InputField label="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" value={form.addressPostalCode || ''}
                  onChange={(v) => setForm({...form, addressPostalCode: v})} editing={editing}
                  type="tel" maxLength={5} placeholder="10110" />
              </div>
            </div>
          </section>
        </div>
      );
    }

    // Helper Components
    function StatCard({ label, value, color = 'emerald' }) {
      const colors = {
        emerald: 'from-emerald-900/40 to-emerald-800/40 border-emerald-700/50 text-emerald-300',
        teal: 'from-teal-900/40 to-teal-800/40 border-teal-700/50 text-teal-300',
        cyan: 'from-cyan-900/40 to-cyan-800/40 border-cyan-700/50 text-cyan-300',
      };
      return (
        <div className={`flex-shrink-0 w-36 bg-gradient-to-br ${colors[color]} border rounded-xl px-4 py-3`}>
          <div className="text-xs text-slate-400 mb-1">{label}</div>
          <div className="text-lg font-bold">{value} FP</div>
        </div>
      );
    }

    function ExpCard({ exp, selectedProducts = [], onSettingsClick }) {
      const percent = exp.target > 0 ? Math.min(100, Math.round((exp.current / exp.target) * 100)) : 0;
      const canUse = exp.current >= exp.target;

      return (
        <div className="bg-slate-900/60 border border-slate-800 rounded-xl p-4">
          <div className="flex items-center justify-between mb-2">
            <h4 className="text-sm font-medium">{exp.label}</h4>
            <div className="flex items-center gap-2">
              <span className="text-xs text-slate-400">{percent}%</span>
              <button
                onClick={() => onSettingsClick(exp)}
                className="w-6 h-6 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-xs transition-colors"
                title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"
              >
                ‚öôÔ∏è
              </button>
            </div>
          </div>

          {/* Selected Insurance Products */}
          {selectedProducts.length > 0 && (
            <div className="mb-3 space-y-2">
              {selectedProducts.map((product, idx) => (
                <div key={idx} className="bg-slate-800/50 rounded-lg p-2.5 border border-slate-700/50">
                  <div className="flex items-start justify-between gap-2 mb-1.5">
                    <div className="flex-1 min-w-0">
                      <div className="text-xs font-medium text-slate-200 truncate">{product.shortTitle}</div>
                      <div className="text-[10px] text-slate-400">{product.insurerCompanyName}</div>
                    </div>
                    <div className="text-right flex-shrink-0">
                      <div className="text-xs font-semibold text-emerald-300">{parseFloat(product.premiumTotal).toLocaleString()} ‡∏ø</div>
                      <div className="text-[10px] text-cyan-400">{parseFloat(product.finpointRatePer100).toFixed(1)} FP/100‡∏ø</div>
                    </div>
                  </div>
                  {/* Progress bar for this insurance */}
                  <div className="w-full h-1.5 rounded-full bg-slate-700 overflow-hidden">
                    <div
                      className="h-full bg-gradient-to-r from-emerald-500 to-cyan-500 transition-all"
                      style={{ width: `${Math.min(100, (exp.current / parseFloat(product.premiumTotal)) * 100)}%` }}
                    ></div>
                  </div>
                  <div className="flex items-center justify-between mt-1">
                    <span className="text-[10px] text-slate-500">
                      ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏° {parseFloat(product.premiumTotal).toLocaleString()} FP
                    </span>
                    <span className="text-[10px] text-emerald-400 font-medium">
                      {Math.min(exp.current, parseFloat(product.premiumTotal)).toLocaleString()} / {parseFloat(product.premiumTotal).toLocaleString()} FP
                    </span>
                  </div>
                </div>
              ))}
            </div>
          )}

          <div className="w-full h-2 rounded-full bg-slate-800 overflow-hidden mb-2">
            <div className="h-full bg-emerald-400 transition-all" style={{ width: `${percent}%` }}></div>
          </div>
          <div className="flex items-center justify-between text-xs">
            <span className="text-slate-400">
              <span className="text-emerald-300 font-medium">{exp.current.toLocaleString()}</span> / {exp.target.toLocaleString()} FP
            </span>
            <button
              className={`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${
                canUse
                  ? 'bg-emerald-600 hover:bg-emerald-700 text-white'
                  : 'bg-emerald-600/20 hover:bg-emerald-600/30 text-emerald-400 border border-emerald-500/30'
              }`}
            >
              {canUse ? '‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå' : '‡∏ã‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô'}
            </button>
          </div>
        </div>
      );
    }

    function InputField({ label, value, onChange, editing, type = "text", placeholder = "", maxLength }) {
      return (
        <div>
          <label className="block text-xs text-slate-400 mb-2">{label}</label>
          {editing ? (
            <input
              type={type}
              value={value || ""}
              onChange={(e) => onChange(e.target.value)}
              placeholder={placeholder}
              maxLength={maxLength}
              className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm focus:outline-none focus:border-emerald-500 placeholder:text-slate-500"
            />
          ) : (
            <div className="px-3 py-2 text-sm text-slate-200">{value || '-'}</div>
          )}
        </div>
      );
    }

    // Database Viewer Component
    function DatabaseViewer() {
      const [tables, setTables] = React.useState([]);
      const [selectedTable, setSelectedTable] = React.useState('');
      const [tableData, setTableData] = React.useState(null);
      const [isLoadingTables, setIsLoadingTables] = React.useState(false);
      const [isLoadingData, setIsLoadingData] = React.useState(false);

      // Fetch tables list
      const fetchTables = async () => {
        try {
          setIsLoadingTables(true);
          const response = await fetch(`${API_BASE}/api/database/tables`);
          if (response.ok) {
            const data = await response.json();
            setTables(data.tables || []);
          }
        } catch (error) {
          console.error('Error fetching tables:', error);
        } finally {
          setIsLoadingTables(false);
        }
      };

      // Fetch table data
      const fetchTableData = async (tableName) => {
        if (!tableName) return;

        try {
          setIsLoadingData(true);
          const response = await fetch(`${API_BASE}/api/database/tables/${tableName}?limit=50`);
          if (response.ok) {
            const data = await response.json();
            setTableData(data);
          }
        } catch (error) {
          console.error('Error fetching table data:', error);
        } finally {
          setIsLoadingData(false);
        }
      };

      // Load tables on mount
      React.useEffect(() => {
        fetchTables();
      }, []);

      // Fetch data when table is selected
      React.useEffect(() => {
        if (selectedTable) {
          fetchTableData(selectedTable);
        }
      }, [selectedTable]);

      return (
        <div className="pb-4">
          {/* Header */}
          <header className="sticky top-0 z-20 bg-slate-900/95 backdrop-blur-lg border-b border-slate-800">
            <div className="px-4 py-3">
              <h1 className="text-base font-semibold">üóÑÔ∏è Database Viewer</h1>
              <p className="text-xs text-slate-400 mt-1">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL</p>
            </div>
          </header>

          {/* Tables List */}
          <section className="p-4">
            <div className="mb-4">
              <label className="block text-sm font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á:</label>
              {isLoadingTables ? (
                <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                  <div className="text-sm text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á...</div>
                </div>
              ) : (
                <select
                  value={selectedTable}
                  onChange={(e) => setSelectedTable(e.target.value)}
                  className="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
                >
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á --</option>
                  {tables.map((table) => (
                    <option key={table.table_name} value={table.table_name}>
                      {table.table_name} ({table.column_count} columns)
                    </option>
                  ))}
                </select>
              )}
            </div>

            {/* Quick Links */}
            <div className="grid grid-cols-2 gap-2 mb-4">
              <button
                onClick={() => window.open(`${API_BASE}/api/database/tables`, '_blank')}
                className="px-3 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors"
              >
                üìã API Tables List
              </button>
              <button
                onClick={() => window.open(`${API_BASE}/api/database/users/all`, '_blank')}
                className="px-3 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-xs font-medium transition-colors"
              >
                üë• All Users
              </button>
            </div>
          </section>

          {/* Table Data */}
          {selectedTable && (
            <section className="px-4">
              {isLoadingData ? (
                <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                  <div className="text-sm text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á...</div>
                </div>
              ) : tableData ? (
                <div className="bg-slate-800 border border-slate-700 rounded-lg overflow-hidden">
                  {/* Table Info */}
                  <div className="px-4 py-3 bg-slate-900/60 border-b border-slate-700">
                    <h3 className="text-sm font-semibold flex items-center gap-2">
                      üìä Table: {tableData.tableName}
                    </h3>
                    <div className="text-xs text-slate-400 mt-1">
                      Total rows: {tableData.total.toLocaleString()} |
                      Showing: {tableData.offset}-{Math.min(tableData.offset + tableData.limit, tableData.total)}
                    </div>
                  </div>

                  {/* Table Content */}
                  <div className="overflow-x-auto max-h-96">
                    <table className="w-full text-xs">
                      <thead className="sticky top-0 bg-slate-900">
                        <tr>
                          {tableData.columns.map((col) => (
                            <th key={col.column_name} className="px-3 py-2 text-left font-medium text-slate-300 border-b border-slate-700">
                              <div>
                                <div>{col.column_name}</div>
                                <div className="text-[9px] text-slate-500">{col.data_type}</div>
                              </div>
                            </th>
                          ))}
                        </tr>
                      </thead>
                      <tbody>
                        {tableData.data.map((row, idx) => (
                          <tr key={idx} className="hover:bg-slate-700/30">
                            {tableData.columns.map((col) => (
                              <td key={col.column_name} className="px-3 py-2 border-t border-slate-800 text-slate-200">
                                {row[col.column_name] !== null ? String(row[col.column_name]) : '-'}
                              </td>
                            ))}
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  {/* Pagination Info */}
                  <div className="px-4 py-3 bg-slate-900/60 border-t border-slate-700 text-xs text-slate-400">
                    <div className="flex items-center justify-between">
                      <span>
                        {tableData.data.length} of {tableData.total} rows
                      </span>
                      {tableData.offset > 0 && (
                        <button
                          onClick={() => fetchTableData(selectedTable)}
                          className="px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs"
                        >
                          Refresh
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              ) : (
                <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 text-center">
                  <div className="text-sm text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á</div>
                </div>
              )}
            </section>
          )}

          {/* Info Section */}
          <section className="px-4 pb-4 mt-4">
            <div className="bg-slate-900/40 border border-slate-800 rounded-xl p-3">
              <div className="flex items-start gap-2">
                <div className="text-slate-400 mt-0.5">‚ÑπÔ∏è</div>
                <div className="flex-1">
                  <div className="text-xs text-slate-400 leading-relaxed">
                    <div className="mb-1">‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</div>
                    <div className="mb-1">‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å PostgreSQL Server ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</div>
                    <div>‚Ä¢ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• 50 ‡πÅ‡∏ñ‡∏ß‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      );
    }

    // Bottom Navigation
    function BottomNav({ currentPage, setCurrentPage }) {
      const navItems = [
        { id: 'home', icon: 'üè†', label: 'Home' },
        { id: 'transactions', icon: 'üìã', label: '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' },
        { id: 'tree', icon: 'üï∏Ô∏è', label: 'Tree' },
        { id: 'acf', icon: 'üîó', label: 'ACF' },
        { id: 'profile', icon: 'üë§', label: 'Profile' },
      ];

      return (
        <nav className="fixed bottom-0 left-0 right-0 z-30 bg-slate-900/95 backdrop-blur-lg border-t border-slate-800 bottom-nav-safe">
          <div className="flex items-center justify-around px-2 py-2">
            {navItems.map((item) => (
              <button
                key={item.id}
                onClick={() => setCurrentPage(item.id)}
                className={`flex flex-col items-center justify-center flex-1 py-2 rounded-lg transition-colors ${
                  currentPage === item.id
                    ? 'text-emerald-300'
                    : 'text-slate-400 hover:text-slate-200'
                }`}
              >
                <span className="text-xl mb-0.5">{item.icon}</span>
                <span className="text-xs font-medium">{item.label}</span>
                {currentPage === item.id && (
                  <div className="w-1 h-1 bg-emerald-400 rounded-full mt-1"></div>
                )}
              </button>
            ))}
          </div>
        </nav>
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
